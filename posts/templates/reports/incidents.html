{% extends "base.html" %}

{% block content %}
    <h1>Posts Reportados</h1>
    <button id="toggle-filters" class="btn btn-info mb-3">Mostrar Filtros</button>
    <div id="filters" style="display: none;">
    <form method="get">
        <div class="form-group">
            <label for="author" class="mr-2">Autor:</label>
            <input type="text" name="author" id="author" class="form-control" value="{{ author }}">
        </div>
        <div class="form-group">
            <label for="category" class="mr-2">Categoria:</label>
            <input type="text" name="category" id="category" class="form-control" value="{{ category }}">
        </div>
        <div class="form-group">
            <label for="status" class="mr-2">Estado:</label>
            <select name="status" id="status" class="form-control">
                <option value="">Todos</option>
                <option value="published" {% if status == 'published' %}selected{% endif %}>Publicado</option>
                <option value="inactive" {% if status == 'inactive' %}selected{% endif %}>Inactivo</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Filtrar</button>
        <a href="{% url 'incidents' %}" class="btn btn-secondary">Limpiar Filtros</a>
    </form>
    </div>
    <table class = "table table-striped table-dark">
        <thead>
            <tr>
                <th>Titulo</th>
                <th>Autor</th>
                <th>Categoria</th>
                <th>Numero de Reportes</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for post in reported_posts %}
                <tr>
                    <td>
                        <a href="{% url 'post' post.pk post.category.name|slugify post.date_posted|date:'m' post.date_posted|date:'Y' post.title|slugify %}">
                            {{ post.title }}
                        </a>
                    </td>
                    <td>{{ post.author }}</td>
                    <td>{{ post.category }}</td>
                    <td>{{ post.reports.count }}</td>
                    <td>
                        <form method="post" action="{% url 'toggle_post_status' post.pk %}">
                            {% csrf_token %}
                            <input type="hidden" name="author" value="{{ author }}">
                            <input type="hidden" name="category" value="{{ category }}">
                            <input type="hidden" name="status" value="{{ status }}">
                            {% if post.status == 'inactive' %}
                                <button type="submit" class="btn btn-success">Activar</button>
                            {% else %}
                                <button type="submit" class="btn btn-warning">Inactivar</button>
                            {% endif %}
                        </form>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
    <script>
        document.getElementById('toggle-filters').addEventListener('click', function() {
            var filters = document.getElementById('filters');
            if (filters.style.display === 'none') {
                filters.style.display = 'block';
            } else {
                filters.style.display = 'none';
            }
        });
    </script>
{% endblock %}